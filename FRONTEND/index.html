<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Carbon Monitoring System</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="js/config.js"></script>

    <style>
      body {
        font-family: "Plus Jakarta Sans", sans-serif;
        background-color: #0f172a;
        overflow: hidden;
      }

      /* Animasi Blob Latar Belakang */
      .blob {
        position: absolute;
        width: 500px;
        height: 500px;
        background: radial-gradient(
          circle,
          rgba(56, 189, 248, 0.15) 0%,
          rgba(56, 189, 248, 0) 70%
        );
        border-radius: 50%;
        z-index: -1;
        filter: blur(40px);
        animation: move 20s infinite alternate;
      }

      @keyframes move {
        from {
          transform: translate(-10%, -10%);
        }
        to {
          transform: translate(20%, 20%);
        }
      }

      .glass-card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .input-field {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .input-field:focus {
        background: rgba(255, 255, 255, 0.08);
        border-color: #38bdf8;
        box-shadow: 0 0 15px rgba(56, 189, 248, 0.2);
      }
    </style>
  </head>

  <body
    class="min-h-screen flex items-center justify-center text-slate-200 px-4"
  >
    <div class="blob" style="top: -10%; left: -10%"></div>
    <div
      class="blob"
      style="
        bottom: -10%;
        right: -10%;
        animation-delay: -5s;
        background: radial-gradient(
          circle,
          rgba(30, 64, 175, 0.2) 0%,
          rgba(30, 64, 175, 0) 70%
        );
      "
    ></div>

    <div class="w-full max-w-md">
      <div
        class="glass-card rounded-[2.5rem] p-10 shadow-2xl relative overflow-hidden"
      >
        <div class="text-center mb-10">
          <div class="inline-block p-3 rounded-2xl bg-sky-500/10 mb-4">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-8 h-8 text-sky-400"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 10V3L4 14h7v7l9-11h-7z"
              />
            </svg>
          </div>
          <h1
            class="text-3xl font-bold bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent"
          >
            Welcome Back
          </h1>
          <p class="text-slate-400 mt-2 text-sm">
            Carbon Monitoring System v2.0
          </p>
        </div>

        <div class="space-y-6">
          <div>
            <label
              class="block text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2 ml-1"
              >Email Address</label
            >
            <input
              id="email"
              type="email"
              placeholder="name@company.com"
              class="input-field w-full rounded-2xl px-5 py-4 text-white outline-none"
            />
          </div>

          <div>
            <label
              class="block text-xs font-semibold uppercase tracking-wider text-slate-400 mb-2 ml-1"
              >Password</label
            >
            <input
              id="password"
              type="password"
              placeholder="••••••••"
              class="input-field w-full rounded-2xl px-5 py-4 text-white outline-none"
            />
          </div>

          <button
            id="loginBtn"
            onclick="login()"
            class="w-full py-4 rounded-2xl font-bold bg-sky-500 hover:bg-sky-400 text-slate-900 transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98] shadow-lg shadow-sky-500/20"
          >
            Sign In
          </button>
        </div>

        <div
          id="error"
          class="mt-6 text-center text-red-400 text-sm font-medium min-h-[20px] animate-pulse"
        ></div>

        <div class="text-center mt-10">
          <p class="text-xs text-slate-500">
            &copy; 2026 Carbon Monitoring System. <br />
            <span class="opacity-50">Secure Environment.</span>
          </p>
        </div>
      </div>
    </div>

    <script>
      async function login() {
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        const errorEl = document.getElementById("error");
        const btn = document.getElementById("loginBtn");

        errorEl.innerText = "";

        if (!email || !password) {
          errorEl.innerText = "Please fill in all fields";
          return;
        }

        // Loading state
        btn.innerText = "Authenticating...";
        btn.disabled = true;
        btn.style.opacity = "0.7";

        try {
          const res = await fetch(`${API_BASE}/auth/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          });

          const data = await res.json();

          if (!res.ok) {
            errorEl.innerText = data.detail || "Invalid credentials";
            resetBtn();
            return;
          }

          localStorage.setItem("token", data.access_token);
          localStorage.setItem("user", JSON.stringify(data.user));

          // Simple Redirect Logic
          const routes = {
            admin: "main.html",
            surveyor: "surveyor_main.html",
          };

          window.location.href =
            routes[data.user.role] ||
            (errorEl.innerText = "Role not recognized");
        } catch (err) {
          errorEl.innerText = "Connection lost. Check your server.";
          resetBtn();
        }
      }

      function resetBtn() {
        const btn = document.getElementById("loginBtn");
        btn.innerText = "Sign In";
        btn.disabled = false;
        btn.style.opacity = "1";
      }
    </script>
  </body>
</html>
