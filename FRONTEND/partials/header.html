<!-- ===============================
AUTH & ROLE PROTECTION
=============================== -->
<script>
  const token = localStorage.getItem("token");
  const userData = localStorage.getItem("user");
  const currentUser = userData ? JSON.parse(userData) : null;

  if (!token || !currentUser) {
    window.location.href = "index.html";
  }

  if (window.REQUIRED_ROLE) {
    const allowed = Array.isArray(window.REQUIRED_ROLE)
      ? window.REQUIRED_ROLE
      : [window.REQUIRED_ROLE];

    if (!allowed.includes(currentUser.role)) {
      alert("Unauthorized");
      window.location.href = "index.html";
    }
  }
</script>

<!-- ===============================
HEADER
=============================== -->
<header class="custom-navbar shadow">
  <nav class="navbar navbar-expand-lg navbar-dark container px-4">

    <a class="navbar-brand text-white" href="main.html">
      Carbon Monitoring System
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarContent">

      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item admin-only">
          <a class="nav-link text-white" href="main.html">Project</a>
        </li>

        <li class="nav-item admin-only">
          <a class="nav-link text-white" href="analysis.html">Carbon Analysis</a>
        </li>

        <li class="nav-item admin-only">
          <a class="nav-link text-white" href="surveyors.html">Surveyor</a>
        </li>

        <li class="nav-item admin-only">
          <a class="nav-link text-white" href="tree_species.html">Tree Species</a>
        </li>

        <li class="nav-item surveyor-only">
          <a class="nav-link text-white" href="surveyor_main.html">Project</a>
        </li>
      </ul>

      <div class="d-flex align-items-center gap-3">
        <span class="user-badge text-white" id="userInfo"></span>
        <button class="btn btn-logout text-white" onclick="logout()">
          Logout
        </button>
      </div>

    </div>
  </nav>
</header>


<script>
  if (currentUser) {
    document.getElementById("userInfo").innerText =
      currentUser.name + " (" + currentUser.role + ")";

    if (currentUser.role !== "admin") {
      document.querySelectorAll(".admin-only").forEach(el => el.remove());
    }

    if (currentUser.role !== "surveyor") {
      document.querySelectorAll(".surveyor-only").forEach(el => el.remove());
    }
  }

  const currentPage = window.location.pathname.split("/").pop();

  document.querySelectorAll(".nav-link").forEach(link => {
    if (link.getAttribute("href") === currentPage) {
      link.classList.add("active");
    }
  });

  function logout() {
    localStorage.removeItem("token");
    localStorage.removeItem("user");
    window.location.href = "index.html";
  }
</script>